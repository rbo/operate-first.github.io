{"componentChunkName":"component---src-templates-jupyter-notebook-js","path":"/data-science/ocp-ci-analysis/notebooks/data-sources/TestGrid/metrics/metric_template.ipynb","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"jupyterNotebook":{"id":"6299985e-eac3-5f66-becf-f3af416b723a >>> JupyterNotebook","html":"<div class=\"notebook-render\"><div class=\"sc-ifAKCX zMCZx\"><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>{Metric name}</h1>\n<ul>\n<li>Write the name of the metric or the name of a group of metrics that will be implemented in this notebook.</li>\n</ul>\n<h2>Description:</h2>\n<p>The desciption of the metrics should explain their definition and purpose. It can include the following points:</p>\n<pre><code>- A list of all the metrics implemented in this notebook.\n- What are these metrics calculating? and how?\n- How to interpret the metrics? \n- Link to the ocp-ci-analysis repository issue.\n- Additional notes and information.\n</code></pre>\n<h1>Example: <em>Flake metrics</em></h1>\n<p><em>One of the key perfomance indicators that we would like to create greater visbility into and track over time is overall number and percent of flakes that occur. Individual test runs are flagged a &quot;flake&quot; if they are run mulitple times with a mix of passes and failes without any changes to the code being tested. Although they occur for individual test runs, there are a number of aggregate views that developers may want to look at to assess the overall health of their project or testing platform. Through this notebook, we will be able to compute:</em></p>\n<ul>\n<li>Percentage of flakes on platform each day</li>\n<li>Percentage of flakes by tab each week</li>\n<li>Percentage of flakes by grid each month</li>\n<li>Percentage of flakes by test overall (this can also be seen as a severity level = overall flake rate of test)</li>\n<li>Severity of flakes</li>\n</ul>\n<p><em>In order to provide maximum flexibility for the end-user of this work, instead of creating a number of dataframes to answer each of these specifc questions, we will define a long and narrow data structure (a list of tuples saved as a csv for now) that contains only 5 columns (&quot;timestamp&quot;, &quot;tab&quot;,&quot;grid&quot;,&quot;test&quot;,&quot;flake&quot;). This allows superset (or pandas) to perform the last filter and/or aggreagtion of interest to an end user. Which is to say, there may appear to be a lot of repetion within the final dataset, but each row should be unique, and it should provide the simpelest useability for an end-user.</em>  </p>\n<p><em>Linked issues: <a href=\"https://github.com/aicoe-aiops/ocp-ci-analysis/issues/104\">Issue 1</a>, <a href=\"https://github.com/aicoe-aiops/ocp-ci-analysis/issues/138\">Issue 2</a></em></p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[1]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\">## Import libraries</span>\n<span class=\"token\" style=\"color:#0000ff\">from</span> enum <span class=\"token\" style=\"color:#0000ff\">import</span> Enum\n<span class=\"token\" style=\"color:#0000ff\">import</span> pandas <span class=\"token\" style=\"color:#0000ff\">as</span> pd\n<span class=\"token\" style=\"color:#0000ff\">import</span> numpy <span class=\"token\" style=\"color:#0000ff\">as</span> np\n<span class=\"token\" style=\"color:#0000ff\">import</span> datetime\n<span class=\"token\" style=\"color:#0000ff\">import</span> os\n<span class=\"token\" style=\"color:#0000ff\">from</span> io <span class=\"token\" style=\"color:#0000ff\">import</span> BytesIO\n<span class=\"token\" style=\"color:#0000ff\">from</span> pathlib <span class=\"token\" style=\"color:#0000ff\">import</span> Path\n<span class=\"token\" style=\"color:#0000ff\">import</span> gzip\n<span class=\"token\" style=\"color:#0000ff\">import</span> json\n<span class=\"token\" style=\"color:#0000ff\">import</span> matplotlib<span class=\"token\" style=\"color:#393A34\">.</span>pyplot <span class=\"token\" style=\"color:#0000ff\">as</span> plt\n<span class=\"token\" style=\"color:#0000ff\">import</span> seaborn <span class=\"token\" style=\"color:#0000ff\">as</span> sns\n<span class=\"token\" style=\"color:#0000ff\">import</span> warnings\n\n<span class=\"token\" style=\"color:#0000ff\">from</span> dotenv <span class=\"token\" style=\"color:#0000ff\">import</span> load_dotenv<span class=\"token\" style=\"color:#393A34\">,</span> find_dotenv\n<span class=\"token\" style=\"color:#0000ff\">import</span> boto3\n\nload_dotenv<span class=\"token\" style=\"color:#393A34\">(</span>find_dotenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nwarnings<span class=\"token\" style=\"color:#393A34\">.</span>filterwarnings<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;ignore&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[2]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\">## Specify variables</span>\n\nMETRIC_NAME <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;example&quot;</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Specify the path for input grid data</span>\nINPUT_DATA_PATH <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;../../../../data/raw/testgrid_183.json.gz&quot;</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Specify the path for output metric data</span>\nOUTPUT_DATA_PATH <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;../../../../data/processed/metrics/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>METRIC_NAME<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&quot;</span></span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\">## CEPH Bucket variables</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">## Create a .env file on your local with the correct configs</span>\ns3_endpoint_url <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;S3_ENDPOINT&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ns3_access_key <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;S3_ACCESS_KEY&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ns3_secret_key <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;S3_SECRET_KEY&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ns3_bucket <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;S3_BUCKET&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ns3_path <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;S3_PROJECT_KEY&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;metrics&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ns3_input_data_path <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;raw_data&quot;</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Specify whether or not we are running this as a notebook or part of an automation pipeline.</span>\nAUTOMATION <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;IN_AUTOMATION&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[3]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">class</span> <span class=\"token\" style=\"color:#2B91AF\">CephCommunication</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token triple-quoted-string\" style=\"color:#A31515\">&quot;&quot;&quot;\n    Class to establish communication with a ceph s3 bucket.\n    It connects with the bucket and provides methods to read and write data in the parquet format.\n    &quot;&quot;&quot;</span>\n\n    <span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">__init__</span><span class=\"token\" style=\"color:#393A34\">(</span>\n        self<span class=\"token\" style=\"color:#393A34\">,</span> s3_endpoint_url<span class=\"token\" style=\"color:#393A34\">,</span> aws_access_key_id<span class=\"token\" style=\"color:#393A34\">,</span> aws_secret_access_key<span class=\"token\" style=\"color:#393A34\">,</span> s3_bucket\n    <span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        self<span class=\"token\" style=\"color:#393A34\">.</span>s3_endpoint_url <span class=\"token\" style=\"color:#393A34\">=</span> s3_endpoint_url\n        self<span class=\"token\" style=\"color:#393A34\">.</span>aws_access_key_id <span class=\"token\" style=\"color:#393A34\">=</span> aws_access_key_id\n        self<span class=\"token\" style=\"color:#393A34\">.</span>aws_secret_access_key <span class=\"token\" style=\"color:#393A34\">=</span> aws_secret_access_key\n        self<span class=\"token\" style=\"color:#393A34\">.</span>s3_resource <span class=\"token\" style=\"color:#393A34\">=</span> boto3<span class=\"token\" style=\"color:#393A34\">.</span>resource<span class=\"token\" style=\"color:#393A34\">(</span>\n            <span class=\"token\" style=\"color:#A31515\">&quot;s3&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n            endpoint_url<span class=\"token\" style=\"color:#393A34\">=</span>self<span class=\"token\" style=\"color:#393A34\">.</span>s3_endpoint_url<span class=\"token\" style=\"color:#393A34\">,</span>\n            aws_access_key_id<span class=\"token\" style=\"color:#393A34\">=</span>self<span class=\"token\" style=\"color:#393A34\">.</span>aws_access_key_id<span class=\"token\" style=\"color:#393A34\">,</span>\n            aws_secret_access_key<span class=\"token\" style=\"color:#393A34\">=</span>self<span class=\"token\" style=\"color:#393A34\">.</span>aws_secret_access_key<span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token\" style=\"color:#393A34\">)</span>\n        self<span class=\"token\" style=\"color:#393A34\">.</span>bucket <span class=\"token\" style=\"color:#393A34\">=</span> s3_bucket\n        <span class=\"token\" style=\"color:#008000;font-style:italic\">## Todo: Add try catch</span>\n\n    <span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">upload_to_ceph</span><span class=\"token\" style=\"color:#393A34\">(</span>self<span class=\"token\" style=\"color:#393A34\">,</span> dataframe<span class=\"token\" style=\"color:#393A34\">,</span> s3_path<span class=\"token\" style=\"color:#393A34\">,</span> filename<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token triple-quoted-string\" style=\"color:#A31515\">&quot;&quot;&quot;\n        This helper function takes as input the data frame to be uploaded, and the output filename.\n        It then saves the data frame in the defined ceph bucket.\n        &quot;&quot;&quot;</span>\n        parquet_buffer <span class=\"token\" style=\"color:#393A34\">=</span> BytesIO<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        dataframe<span class=\"token\" style=\"color:#393A34\">.</span>to_parquet<span class=\"token\" style=\"color:#393A34\">(</span>parquet_buffer<span class=\"token\" style=\"color:#393A34\">)</span>\n        s3_obj <span class=\"token\" style=\"color:#393A34\">=</span> self<span class=\"token\" style=\"color:#393A34\">.</span>s3_resource<span class=\"token\" style=\"color:#393A34\">.</span>Object<span class=\"token\" style=\"color:#393A34\">(</span>self<span class=\"token\" style=\"color:#393A34\">.</span>bucket<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>s3_path<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>filename<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\n        status <span class=\"token\" style=\"color:#393A34\">=</span> s3_obj<span class=\"token\" style=\"color:#393A34\">.</span>put<span class=\"token\" style=\"color:#393A34\">(</span>Body<span class=\"token\" style=\"color:#393A34\">=</span>parquet_buffer<span class=\"token\" style=\"color:#393A34\">.</span>getvalue<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        <span class=\"token\" style=\"color:#0000ff\">return</span> status\n\n    <span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">read_from_ceph</span><span class=\"token\" style=\"color:#393A34\">(</span>self<span class=\"token\" style=\"color:#393A34\">,</span> s3_path<span class=\"token\" style=\"color:#393A34\">,</span> filename<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token triple-quoted-string\" style=\"color:#A31515\">&quot;&quot;&quot;\n        Helper function to read from ceph and see if the saved data is correct.\n        &quot;&quot;&quot;</span>\n        <span class=\"token builtin\">buffer</span> <span class=\"token\" style=\"color:#393A34\">=</span> BytesIO<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        s3_object <span class=\"token\" style=\"color:#393A34\">=</span> self<span class=\"token\" style=\"color:#393A34\">.</span>s3_resource<span class=\"token\" style=\"color:#393A34\">.</span>Object<span class=\"token\" style=\"color:#393A34\">(</span>self<span class=\"token\" style=\"color:#393A34\">.</span>bucket<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>s3_path<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>filename<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\n        s3_object<span class=\"token\" style=\"color:#393A34\">.</span>download_fileobj<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">buffer</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        df_temp <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>read_parquet<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">buffer</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        <span class=\"token\" style=\"color:#0000ff\">return</span> df_temp</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[4]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">save_to_disk</span><span class=\"token\" style=\"color:#393A34\">(</span>dataframe<span class=\"token\" style=\"color:#393A34\">,</span> path<span class=\"token\" style=\"color:#393A34\">,</span> filename<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token triple-quoted-string\" style=\"color:#A31515\">&quot;&quot;&quot;\n    Helper function to save the dataframe\n    as a parquet file to disk.\n    &quot;&quot;&quot;</span>\n    dataset_base_path <span class=\"token\" style=\"color:#393A34\">=</span> Path<span class=\"token\" style=\"color:#393A34\">(</span>path<span class=\"token\" style=\"color:#393A34\">)</span>\n    dataset_base_path<span class=\"token\" style=\"color:#393A34\">.</span>mkdir<span class=\"token\" style=\"color:#393A34\">(</span>parents<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> exist_ok<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    dataframe<span class=\"token\" style=\"color:#393A34\">.</span>to_parquet<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>path<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>filename<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> <span class=\"token\" style=\"color:#36acaa\">True</span>\n\n\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">read_from_disk</span><span class=\"token\" style=\"color:#393A34\">(</span>path<span class=\"token\" style=\"color:#393A34\">,</span> filename<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token triple-quoted-string\" style=\"color:#A31515\">&quot;&quot;&quot;\n    Helper function to read from disk and see if the saved data is the same.\n    &quot;&quot;&quot;</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>read_parquet<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>path<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>filename<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[5]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\">## Import data</span>\ntimestamp <span class=\"token\" style=\"color:#393A34\">=</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>datetime<span class=\"token\" style=\"color:#393A34\">.</span>today<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">if</span> AUTOMATION<span class=\"token\" style=\"color:#393A34\">:</span>\n    filename <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;testgrid_</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>day<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>month<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">.json&quot;</span></span>\n    cc <span class=\"token\" style=\"color:#393A34\">=</span> CephCommunication<span class=\"token\" style=\"color:#393A34\">(</span>s3_endpoint_url<span class=\"token\" style=\"color:#393A34\">,</span> s3_access_key<span class=\"token\" style=\"color:#393A34\">,</span> s3_secret_key<span class=\"token\" style=\"color:#393A34\">,</span> s3_bucket<span class=\"token\" style=\"color:#393A34\">)</span>\n    s3_object <span class=\"token\" style=\"color:#393A34\">=</span> cc<span class=\"token\" style=\"color:#393A34\">.</span>s3_resource<span class=\"token\" style=\"color:#393A34\">.</span>Object<span class=\"token\" style=\"color:#393A34\">(</span>s3_bucket<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>s3_input_data_path<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>filename<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\n    file_content <span class=\"token\" style=\"color:#393A34\">=</span> s3_object<span class=\"token\" style=\"color:#393A34\">.</span>get<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>read<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>decode<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;utf-8&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    testgrid_data <span class=\"token\" style=\"color:#393A34\">=</span> json<span class=\"token\" style=\"color:#393A34\">.</span>loads<span class=\"token\" style=\"color:#393A34\">(</span>file_content<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#0000ff\">with</span> gzip<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">open</span><span class=\"token\" style=\"color:#393A34\">(</span>INPUT_DATA_PATH<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;rb&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">as</span> read_file<span class=\"token\" style=\"color:#393A34\">:</span>\n        testgrid_data <span class=\"token\" style=\"color:#393A34\">=</span> json<span class=\"token\" style=\"color:#393A34\">.</span>load<span class=\"token\" style=\"color:#393A34\">(</span>read_file<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[6]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\">## Helper classes and functions</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">## In your metric notebook, you could just</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">## load the template notebook functions</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">## If your metric requires specific helper</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">## functions, write them here, otherwise if these</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">## functions are general, update the template.</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">## Author: AIOps</span>\n\n\n<span class=\"token\" style=\"color:#0000ff\">class</span> <span class=\"token\" style=\"color:#2B91AF\">TestStatus</span><span class=\"token\" style=\"color:#393A34\">(</span>Enum<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token triple-quoted-string\" style=\"color:#A31515\">&quot;&quot;&quot;\n    Enum to encode what test status each value in testgrid corresponds to\n\n    Basically python equivalent of the enum here:\n    https://github.com/GoogleCloudPlatform/testgrid/blob/a18fe953cf98174c215c43e0258b0515e37c283b/pb/test_status/test_status.proto#L3\n    &quot;&quot;&quot;</span>\n\n    NO_RESULT <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\n    PASS <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">1</span>\n    PASS_WITH_ERRORS <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">2</span>\n    PASS_WITH_SKIPS <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">3</span>\n    RUNNING <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">4</span>\n    CATEGORIZED_ABORT <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">5</span>\n    UNKNOWN <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">6</span>\n    CANCEL <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">7</span>\n    BLOCKED <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">8</span>\n    TIMED_OUT <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">9</span>\n    CATEGORIZED_FAIL <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">10</span>\n    BUILD_FAIL <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">11</span>\n    FAIL <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">12</span>\n    FLAKY <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">13</span>\n    TOOL_FAIL <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">14</span>\n    BUILD_PASSED <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">15</span>\n\n\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">decode_run_length</span><span class=\"token\" style=\"color:#393A34\">(</span>x<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token triple-quoted-string\" style=\"color:#A31515\">&quot;&quot;&quot;\n    Decodes the run length encoded data into an unrolled form.\n    Returns a list of values.\n\n    E.g. takes in [{&quot;value&quot;:12, &quot;count&quot;:3}, {&quot;value&quot;:1, &quot;count&quot;:2}]\n    and gives [12, 12, 12, 1, 1]\n    &quot;&quot;&quot;</span>\n    lst <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> run_length <span class=\"token\" style=\"color:#0000ff\">in</span> x<span class=\"token\" style=\"color:#393A34\">:</span>\n        extension <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>run_length<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;value&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">*</span> run_length<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;count&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n        lst<span class=\"token\" style=\"color:#393A34\">.</span>extend<span class=\"token\" style=\"color:#393A34\">(</span>extension<span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> lst\n\n\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">testgrid_labelwise_encoding</span><span class=\"token\" style=\"color:#393A34\">(</span>data<span class=\"token\" style=\"color:#393A34\">,</span> label<span class=\"token\" style=\"color:#393A34\">,</span> overall_only<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n\n    <span class=\"token triple-quoted-string\" style=\"color:#A31515\">&quot;&quot;&quot;\n    Run length encode the dataset and unroll the dataset into a list.\n    Return flattened list after encoding specified value as\n    True and rest as False\n    &quot;&quot;&quot;</span>\n\n    percent_label_by_grid_csv <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n    <span class=\"token\" style=\"color:#0000ff\">for</span> tab <span class=\"token\" style=\"color:#0000ff\">in</span> data<span class=\"token\" style=\"color:#393A34\">.</span>keys<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n\n        <span class=\"token\" style=\"color:#0000ff\">for</span> grid <span class=\"token\" style=\"color:#0000ff\">in</span> data<span class=\"token\" style=\"color:#393A34\">[</span>tab<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>keys<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n            current_grid <span class=\"token\" style=\"color:#393A34\">=</span> data<span class=\"token\" style=\"color:#393A34\">[</span>tab<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span>grid<span class=\"token\" style=\"color:#393A34\">]</span>\n\n            <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>current_grid<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;grid&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">==</span> <span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                <span class=\"token\" style=\"color:#0000ff\">pass</span>\n            <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                <span class=\"token\" style=\"color:#008000;font-style:italic\"># get all timestamps for this grid (x-axis of grid)</span>\n                timestamps <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>\n                    datetime<span class=\"token\" style=\"color:#393A34\">.</span>datetime<span class=\"token\" style=\"color:#393A34\">.</span>fromtimestamp<span class=\"token\" style=\"color:#393A34\">(</span>x <span class=\"token\" style=\"color:#393A34\">//</span> <span class=\"token\" style=\"color:#36acaa\">1000</span><span class=\"token\" style=\"color:#393A34\">)</span>\n                    <span class=\"token\" style=\"color:#0000ff\">for</span> x <span class=\"token\" style=\"color:#0000ff\">in</span> current_grid<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;timestamps&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n                <span class=\"token\" style=\"color:#393A34\">]</span>\n                <span class=\"token\" style=\"color:#008000;font-style:italic\"># get all test names for this grid (y-axis of grid)</span>\n                tests <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>\n                    current_grid<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;grid&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;name&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n                    <span class=\"token\" style=\"color:#0000ff\">for</span> i <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token builtin\">range</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>current_grid<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;grid&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n                <span class=\"token\" style=\"color:#393A34\">]</span>\n\n                graphs <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>\n                    current_grid<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;grid&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;graphs&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n                    <span class=\"token\" style=\"color:#0000ff\">for</span> i <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token builtin\">range</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>current_grid<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;grid&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n                <span class=\"token\" style=\"color:#393A34\">]</span>\n\n                <span class=\"token\" style=\"color:#008000;font-style:italic\"># unroll the run-length encoding and set bool for flake or not (x==13)</span>\n                decoded <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>\n                    <span class=\"token\" style=\"color:#393A34\">(</span>\n                        np<span class=\"token\" style=\"color:#393A34\">.</span>array<span class=\"token\" style=\"color:#393A34\">(</span>decode_run_length<span class=\"token\" style=\"color:#393A34\">(</span>current_grid<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;grid&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;statuses&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n                        <span class=\"token\" style=\"color:#393A34\">==</span> label\n                    <span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>tolist<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n                    <span class=\"token\" style=\"color:#0000ff\">for</span> i <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token builtin\">range</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>current_grid<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;grid&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n                <span class=\"token\" style=\"color:#393A34\">]</span>\n\n                <span class=\"token\" style=\"color:#008000;font-style:italic\"># add the timestamp to bool value</span>\n                decoded <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token builtin\">list</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">zip</span><span class=\"token\" style=\"color:#393A34\">(</span>timestamps<span class=\"token\" style=\"color:#393A34\">,</span> g<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">for</span> g <span class=\"token\" style=\"color:#0000ff\">in</span> decoded<span class=\"token\" style=\"color:#393A34\">]</span>\n                <span class=\"token\" style=\"color:#008000;font-style:italic\"># add the test, tab and grid name to each entry</span>\n                <span class=\"token\" style=\"color:#008000;font-style:italic\"># TODO: any ideas for avoiding this quad-loop</span>\n                <span class=\"token\" style=\"color:#008000;font-style:italic\"># if the label is passed as an arg, add the timestamp, tab,</span>\n                <span class=\"token\" style=\"color:#008000;font-style:italic\"># grid, tests, graphs metric and the bool values</span>\n                <span class=\"token\" style=\"color:#0000ff\">if</span> label<span class=\"token\" style=\"color:#393A34\">:</span>\n                    <span class=\"token\" style=\"color:#0000ff\">for</span> i<span class=\"token\" style=\"color:#393A34\">,</span> d <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token\" style=\"color:#393A34\">(</span>decoded<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                        <span class=\"token\" style=\"color:#0000ff\">for</span> j<span class=\"token\" style=\"color:#393A34\">,</span> k <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token\" style=\"color:#393A34\">(</span>d<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                            <span class=\"token\" style=\"color:#008000;font-style:italic\"># here we are fetching the test duration values for the tests</span>\n                            <span class=\"token\" style=\"color:#008000;font-style:italic\"># however,since not all tests contain time duration values,</span>\n                            <span class=\"token\" style=\"color:#008000;font-style:italic\"># we are only considering the &#x27;Overall&#x27; test and fetching the</span>\n                            <span class=\"token\" style=\"color:#008000;font-style:italic\"># time duration values for this test and setting it to &#x27;None&#x27;</span>\n                            <span class=\"token\" style=\"color:#008000;font-style:italic\"># for all the other tests in each grid</span>\n                            <span class=\"token\" style=\"color:#0000ff\">if</span> overall_only<span class=\"token\" style=\"color:#393A34\">:</span>\n                                <span class=\"token\" style=\"color:#0000ff\">if</span> tests<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">==</span> <span class=\"token\" style=\"color:#A31515\">&quot;Overall&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                                    <span class=\"token\" style=\"color:#0000ff\">try</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                                        test_duration <span class=\"token\" style=\"color:#393A34\">=</span> graphs<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;values&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span>j<span class=\"token\" style=\"color:#393A34\">]</span>\n                                    <span class=\"token\" style=\"color:#0000ff\">except</span> IndexError<span class=\"token\" style=\"color:#393A34\">:</span>\n                                        test_duration <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n                                <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                                    test_duration <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n                            <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                                <span class=\"token\" style=\"color:#0000ff\">try</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                                    graphs<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>keys<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n                                    <span class=\"token\" style=\"color:#0000ff\">try</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                                        graphs<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;values&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span>j<span class=\"token\" style=\"color:#393A34\">]</span>\n                                        test_duration <span class=\"token\" style=\"color:#393A34\">=</span> graphs<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;values&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span>j<span class=\"token\" style=\"color:#393A34\">]</span>\n                                    <span class=\"token\" style=\"color:#0000ff\">except</span> IndexError<span class=\"token\" style=\"color:#393A34\">:</span>\n                                        test_duration <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n                                <span class=\"token\" style=\"color:#0000ff\">except</span> TypeError<span class=\"token\" style=\"color:#393A34\">:</span>\n                                    test_duration <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n\n                            decoded<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span>j<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">(</span>\n                                k<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span>\n                                tab<span class=\"token\" style=\"color:#393A34\">,</span>\n                                grid<span class=\"token\" style=\"color:#393A34\">,</span>\n                                tests<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span>\n                                test_duration<span class=\"token\" style=\"color:#393A34\">,</span>\n                                k<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span>\n                            <span class=\"token\" style=\"color:#393A34\">)</span>\n                    <span class=\"token\" style=\"color:#008000;font-style:italic\"># accumulate the results</span>\n                    percent_label_by_grid_csv<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span>decoded<span class=\"token\" style=\"color:#393A34\">)</span>\n\n                <span class=\"token\" style=\"color:#008000;font-style:italic\"># if label is &#x27;None&#x27;, add only the timestamp, tab, grid, tests and test</span>\n                <span class=\"token\" style=\"color:#008000;font-style:italic\"># duration values</span>\n                <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                    <span class=\"token\" style=\"color:#0000ff\">for</span> i<span class=\"token\" style=\"color:#393A34\">,</span> d <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token\" style=\"color:#393A34\">(</span>decoded<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                        <span class=\"token\" style=\"color:#0000ff\">for</span> j<span class=\"token\" style=\"color:#393A34\">,</span> k <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token\" style=\"color:#393A34\">(</span>d<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                            <span class=\"token\" style=\"color:#008000;font-style:italic\"># here we are fetching the time duration values for the tests</span>\n                            <span class=\"token\" style=\"color:#008000;font-style:italic\"># however,since not all tests contain time duration values,</span>\n                            <span class=\"token\" style=\"color:#008000;font-style:italic\"># we are only considering the &#x27;Overall&#x27; test and fetching the time duration</span>\n                            <span class=\"token\" style=\"color:#008000;font-style:italic\"># values for this test in each grid</span>\n                            <span class=\"token\" style=\"color:#0000ff\">if</span> overall_only<span class=\"token\" style=\"color:#393A34\">:</span>\n                                <span class=\"token\" style=\"color:#0000ff\">if</span> tests<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">==</span> <span class=\"token\" style=\"color:#A31515\">&quot;Overall&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                                    <span class=\"token\" style=\"color:#0000ff\">try</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                                        test_duration <span class=\"token\" style=\"color:#393A34\">=</span> graphs<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;values&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span>j<span class=\"token\" style=\"color:#393A34\">]</span>\n                                    <span class=\"token\" style=\"color:#0000ff\">except</span> IndexError<span class=\"token\" style=\"color:#393A34\">:</span>\n                                        <span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span>\n                                            &quot;Test duration value does <span class=\"token\" style=\"color:#0000ff\">not</span> exist <span class=\"token\" style=\"color:#0000ff\">for</span> <span class=\"token builtin\">all</span> \\\n                                            timestamps <span class=\"token\" style=\"color:#0000ff\">for</span> test Overall <span class=\"token\" style=\"color:#0000ff\">in</span> grid &quot;<span class=\"token\" style=\"color:#393A34\">,</span>\n                                            grid<span class=\"token\" style=\"color:#393A34\">,</span>\n                                            <span class=\"token\" style=\"color:#A31515\">&quot;in tab &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n                                            tab<span class=\"token\" style=\"color:#393A34\">,</span>\n                                        <span class=\"token\" style=\"color:#393A34\">)</span>\n                                        test_duration <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n                                <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                                    test_duration <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n                            <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                                <span class=\"token\" style=\"color:#0000ff\">try</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                                    graphs<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>keys<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n                                    <span class=\"token\" style=\"color:#0000ff\">try</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                                        graphs<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;values&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span>j<span class=\"token\" style=\"color:#393A34\">]</span>\n                                        test_duration <span class=\"token\" style=\"color:#393A34\">=</span> graphs<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;values&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span>j<span class=\"token\" style=\"color:#393A34\">]</span>\n                                    <span class=\"token\" style=\"color:#0000ff\">except</span> IndexError<span class=\"token\" style=\"color:#393A34\">:</span>\n                                        test_duration <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n                                <span class=\"token\" style=\"color:#0000ff\">except</span> TypeError<span class=\"token\" style=\"color:#393A34\">:</span>\n                                    test_duration <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n\n                            decoded<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span>j<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">(</span>k<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> tab<span class=\"token\" style=\"color:#393A34\">,</span> grid<span class=\"token\" style=\"color:#393A34\">,</span> tests<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> test_duration<span class=\"token\" style=\"color:#393A34\">)</span>\n                    percent_label_by_grid_csv<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span>decoded<span class=\"token\" style=\"color:#393A34\">)</span>\n\n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># output above leaves us with a doubly nested list. Flatten</span>\n    flat_list <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>item <span class=\"token\" style=\"color:#0000ff\">for</span> sublist <span class=\"token\" style=\"color:#0000ff\">in</span> percent_label_by_grid_csv <span class=\"token\" style=\"color:#0000ff\">for</span> item <span class=\"token\" style=\"color:#0000ff\">in</span> sublist<span class=\"token\" style=\"color:#393A34\">]</span>\n    flatter_list <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>item <span class=\"token\" style=\"color:#0000ff\">for</span> sublist <span class=\"token\" style=\"color:#0000ff\">in</span> flat_list <span class=\"token\" style=\"color:#0000ff\">for</span> item <span class=\"token\" style=\"color:#0000ff\">in</span> sublist<span class=\"token\" style=\"color:#393A34\">]</span>\n\n    <span class=\"token\" style=\"color:#0000ff\">return</span> flatter_list</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Calculation</h2>\n<ul>\n<li>In this section, calculate the metric values from the data.</li>\n<li>For example, we shall use flake metrics calculation.</li>\n</ul></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[7]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">unrolled_list <span class=\"token\" style=\"color:#393A34\">=</span> testgrid_labelwise_encoding<span class=\"token\" style=\"color:#393A34\">(</span>testgrid_data<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">13</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>unrolled_list<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>27192485\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[8]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Next, print the data frame head with the metric values.</span>\ndf <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>DataFrame<span class=\"token\" style=\"color:#393A34\">(</span>\n    unrolled_list<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">200</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    columns<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;timestamp&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;tab&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;grid&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;test&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;test_duration&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;flake&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\ndf<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>timestamp</th>\n      <th>tab</th>\n      <th>grid</th>\n      <th>test</th>\n      <th>test_duration</th>\n      <th>flake</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2021-03-15 23:40:20</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>80.283333</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2021-03-15 00:01:06</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>92.050000</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2021-03-13 20:51:32</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>80.983333</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2021-03-13 07:51:20</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>117.716667</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2021-03-13 06:43:20</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>108.633333</td>\n      <td>False</td>\n    </tr>\n  </tbody>\n</table>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[9]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\">## Calculate flake severity or flake rate by tests</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">## Moving forward, this will be aggregated in Superset</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">## For the sake of completeness, it is implmented here</span>\nflake_severity <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">.</span>groupby<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;test&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>flake<span class=\"token\" style=\"color:#393A34\">.</span>mean<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>reset_index<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\nflake_severity<span class=\"token\" style=\"color:#393A34\">.</span>rename<span class=\"token\" style=\"color:#393A34\">(</span>columns<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#A31515\">&quot;flake&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;flake_severity&quot;</span><span class=\"token\" style=\"color:#393A34\">}</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\nflake_severity</code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>test</th>\n      <th>flake_severity</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>Overall</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>openshift-tests.[sig-api-machinery] CustomReso...</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>openshift-tests.[sig-api-machinery] CustomReso...</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>openshift-tests.[sig-api-machinery] CustomReso...</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>openshift-tests.[sig-api-machinery] CustomReso...</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>openshift-tests.[sig-api-machinery] CustomReso...</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>operator.Run multi-stage test e2e-metal-assist...</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>operator.Run multi-stage test e2e-metal-assist...</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>operator.Run multi-stage test e2e-metal-assist...</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>operator.Run multi-stage test e2e-metal-assist...</td>\n      <td>False</td>\n    </tr>\n  </tbody>\n</table>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Visualization</h2>\n<ul>\n<li>In this optional section, you can provide a quick visualization of the metric that you computed.</li>\n<li>Although, the main visualization will be done in Superset, the graphs helps to understand the metric better.</li>\n<li>The following plot shows the flake severity metric for a snapshot of the data.</li>\n</ul></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[10]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">sns<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">set</span><span class=\"token\" style=\"color:#393A34\">(</span>rc<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#A31515\">&quot;figure.figsize&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">15</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">10</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">}</span><span class=\"token\" style=\"color:#393A34\">)</span>\nflake_severity<span class=\"token\" style=\"color:#393A34\">.</span>flake_severity<span class=\"token\" style=\"color:#393A34\">.</span>hist<span class=\"token\" style=\"color:#393A34\">(</span>bins<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">50</span><span class=\"token\" style=\"color:#393A34\">)</span>\nplt<span class=\"token\" style=\"color:#393A34\">.</span>ylabel<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;Tests&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nplt<span class=\"token\" style=\"color:#393A34\">.</span>xlabel<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;Flake Severity&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nplt<span class=\"token\" style=\"color:#393A34\">.</span>ylim<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">25</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nplt<span class=\"token\" style=\"color:#393A34\">.</span>show<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><img alt=\"\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA3sAAAJWCAYAAADhiJ6/AAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjQuMSwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy/Z1A+gAAAACXBIWXMAAAsTAAALEwEAmpwYAAAkw0lEQVR4nO3de5TU9X3/8dfuImgDFBeBLGq0egKlVbyRYmP1eEDFC8REq1hMYzxeY4vxRmINhXjDrqF6omLRxhhtOd6jZhFFjW0kNrG16jGGxFtAIxBQQBEIIrv7+8OT/UlBshJmhv34ePzFznxn5g28D/rc73dm69rb29sDAABAUeprPQAAAABbntgDAAAokNgDAAAokNgDAAAokNgDAAAokNgDAAAoULdqvMjy5cvzta99La+99lq6d++eXXbZJZdcckkaGxszePDgDBo0KPX173fnlVdemcGDB1djLAAAgGLVVePn7L311lt54YUXMnz48CRJc3Nz3n777UyZMiWDBw/O008/nU984hOVHgMAAOBjoyqXcfbp06cj9JJk7733zsKFC6vx0gAAAB9LVbmM84Pa2tpy2223ZcSIER23/e3f/m1aW1tz0EEHZfz48enevXu1xwIAAChKVS7j/KCLL744ixcvznXXXZf6+vosWrQoTU1NWblyZSZMmJBBgwbl3HPPreZIAAAAxanqmb3m5ua8+uqrmT59escHsjQ1NSVJevbsmeOOOy4333zzR37e5ctXpa2tqs3KFta3b88sXbqy1mNQKPtFJdkvKsl+UWl2rOurr6/L9ttv/PNPqhZ7V111VZ5//vnceOONHZdpvv322+nRo0e23XbbrFu3LrNnz86QIUM+8nO3tbWLvQL4O6SS7BeVZL+oJPtFpdmxclUl9l566aXccMMN2XXXXXPCCSckSXbaaaeceuqpmTRpUurq6rJu3brss88++epXv1qNkQAAAIpWldj79Kc/nRdeeGGj97W0tFRjBAAAgI+VqvzoBQAAAKpL7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABRI7AEAABSoWzVeZPny5fna176W1157Ld27d88uu+ySSy65JI2NjXn22WczadKkvPvuu9lxxx3zrW99K3379q3GWAAAAMWqypm9urq6nHrqqZk9e3ZaWlqy8847Z+rUqWlra8uECRMyadKkzJ49O8OGDcvUqVOrMRIAAEDRqhJ7ffr0yfDhwzu+3nvvvbNw4cI8//zz6dGjR4YNG5YkOeGEE/LQQw9VYyQAAICiVeUyzg9qa2vLbbfdlhEjRmTRokUZOHBgx32NjY1pa2vLW2+9lT59+nT6Ofv27VmBSam2fv161XoECma/qCT7RSXZLyrNjpWr6rF36aWX5o/+6I/yxS9+MY888sgWec6lS1emra19izwXtdGvX6+88cY7tR6DQtkvKsl+UUn2i0qzY11ffX3dh578qmrsNTc359VXX8306dNTX1+fpqamLFy4sOP+ZcuWpb6+/iOd1QMAAGBDVfvRC1dddVWef/75TJs2Ld27d0+S7LHHHlmzZk2eeuqpJMntt9+eww8/vFojAQAAFKsqZ/Zeeuml3HDDDdl1111zwgknJEl22mmnTJs2LVdeeWUmT5683o9eAAAA4A9Tldj79Kc/nRdeeGGj9+27775paWmpxhgAAAAfG1W7jBMAAIDqEXsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAFEnsAAAAF6latF2pubs7s2bOzYMGCtLS0ZNCgQUmSESNGpHv37unRo0eS5IILLsiBBx5YrbEAAACKVLXYGzlyZL70pS/lxBNP3OC+a665piP+AAAA+MNVLfaGDRtWrZcCAAD42Kta7G3KBRdckPb29uy3334577zz0rt374/0+L59e1ZoMqqpX79etR6BgtkvKsl+UUn2i0qzY+WqeezNmDEjTU1NWbt2bS6//PJccsklmTp16kd6jqVLV6atrb1CE1IN/fr1yhtvvFPrMSiU/aKS7BeVZL+oNDvW9dXX133oya+afxpnU1NTkqR79+4ZN25cnn766RpPBAAA0PXVNPZWr16dd955/zsJ7e3tmTVrVoYMGVLLkQAAAIpQtcs4L7vssjz88MN58803c/LJJ6dPnz6ZPn16xo8fn9bW1rS1tWX33XfP5MmTqzUSAABAsera29u7/JvdvGev63O9OJVkv6gk+0Ul2S8qzY51fVv1e/YAAADY8sQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgcQeAABAgbp15qCXX345ffr0yQ477JBVq1blpptuSn19fU455ZRst912lZ4RAACAj6hTZ/bOO++8rFixIknS3Nyc//mf/8mzzz6bSZMmVXQ4AAAANk+nzuwtWLAgu+22W9rb2/PII4/kgQceyLbbbpuRI0dWej4AAAA2Q6dir0ePHlm5cmVeeeWVNDU1pbGxMevWrcu7775b6fkAAADYDJ2KvdGjR+ekk07KqlWr8sUvfjFJMnfu3Oy0004VHQ4AAIDN06nYu+iii/LjH/843bp1y/77758kqauryz/8wz9UdDgAAAA2T6c+oOWyyy7LX/3VX3WEXpLsueeeeeyxxyo2GAAAAJuvU7H3/e9/f6O3/+AHP9iiwwAAALBlbPIyzrvvvjtJ0tra2vHr3/n1r3+dPn36VGwwAAAANt8mY+/+++9Pkrz33nsdv07ef7/eDjvskObm5spOBwAAwGbZZOz927/9W5Lk6quvzrnnnluVgQAAAPjDdeo9e7/7sQvJ+5d03nPPPbnvvvvS1tZW0eEAAADYPJ2KvTPOOCOvvvpqkuSqq67Kd7/73dx88835p3/6p4oOBwAAwObpVOzNnz8/Q4YMSZK0tLTkX//1X3PLLbdk1qxZFR0OAACAzdOpH6peX1+f9957L/PmzUuvXr0ycODAtLW1dVzaCQAAwNalU7F30EEH5atf/WreeuutHHnkkUmSl19+OQMGDKjocAAAAGyeTsXe5ZdfnnvvvTfdunXL0UcfnSRZvnx5xo8fX9HhAAAA2Dydir3u3btn7NixaWtry5tvvpn+/ftn+PDhlZ4NAACAzdSpD2hZsWJFzj///AwdOjSHHXZYkuSHP/xhrr766ooOBwAAwObpVOxNnjw5PXv2zGOPPZZtttkmSbLPPvvkwQcfrOhwAAAAbJ5OXcb5k5/8JHPmzMk222yTurq6JEljY2OWLl1a0eEAAADYPJ06s9erV68sX758vdsWLlyYfv36VWQoAAAA/jCbjL2ZM2cmSY477ricffbZ+elPf5q2trY888wz+frXv54TTjihKkMCAADw0Wwy9iZNmpQkOe2003LEEUfkkksuybp163LRRRdl5MiROemkk6oyJAAAAB/NJt+z197eniSpq6vLSSedJO4AAAC6iE3GXltbW3760592RN/G/OVf/uUWHwoAAIA/zCZjb+3atfnGN77xobFXV1eXH/7whxUZDAAAgM23ydjbbrvtxBwAAEAX1KkfvQAAAEDXssnY29R79QAAANh6bTL2nnnmmWrNAQAAwBbkMk4AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACiT0AAIACVSX2mpubM2LEiAwePDgvvvhix+3z5s3L2LFjM2rUqIwdOzbz58+vxjgAAADFq0rsjRw5MjNmzMiOO+643u2TJ0/OuHHjMnv27IwbNy6TJk2qxjgAAADFq0rsDRs2LE1NTevdtnTp0sydOzejR49OkowePTpz587NsmXLqjESAABA0Wr2nr1FixZlwIABaWhoSJI0NDSkf//+WbRoUa1GAgAAKEa3Wg+wJfTt27PWI7AF9OvXq9YjUDD7RaWsfa91s/dr7Xut6b5NwxaeiNL494tKs2PlqlnsNTU1ZfHixWltbU1DQ0NaW1uzZMmSDS737IylS1emra29AlNSLf369cobb7xT6zEolP2ikvr165Ux59+/WY9t+eej7Sab5N8vKs2OdX319XUfevKrZpdx9u3bN0OGDMnMmTOTJDNnzsyQIUPS2NhYq5EAAACKUZUze5dddlkefvjhvPnmmzn55JPTp0+fPPDAA/nmN7+ZCy+8MNdff3169+6d5ubmaowDAABQvKrE3sSJEzNx4sQNbt99991z1113VWMEAACAj5WaXcYJAABA5Yg9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAok9AACAAnWr9QBJMmLEiHTv3j09evRIklxwwQU58MADazwVAABA17VVxF6SXHPNNRk0aFCtxwAAACiCyzgBAAAKtNWc2bvgggvS3t6e/fbbL+edd1569+5d65EAAAC6rLr29vb2Wg+xaNGiNDU1Ze3atbn88suzatWqTJ06tdZjAUCnjDn//s16XMs/H72FJwGA/2+rOLPX1NSUJOnevXvGjRuXr3zlKx/p8UuXrkxbW82blT9Av3698sYb79R6DAplv6ikfv16/UGPt5tsin+/qDQ71vXV19elb9+eG7+vyrNsYPXq1XnnnfcXrL29PbNmzcqQIUNqPBUAAEDXVvMze0uXLs348ePT2tqatra27L777pk8eXKtxwIAAOjSah57O++8c+67775ajwEAAFCUml/GCQAAwJYn9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAok9gAAAAq0VcTevHnzMnbs2IwaNSpjx47N/Pnzaz0SAABAl7ZVxN7kyZMzbty4zJ49O+PGjcukSZNqPRIAAECX1q3WAyxdujRz587NzTffnCQZPXp0Lr300ixbtiyNjY2deo76+rpKjkiV+HukkuwXldR/++02+7F2k9/HjlBpdqxr29TfX81jb9GiRRkwYEAaGhqSJA0NDenfv38WLVrU6djbfvtPVHJEqqRv3561HoGC2S8q6aaJh232Y+0mv48dodLsWLm2iss4AQAA2LJqHntNTU1ZvHhxWltbkyStra1ZsmRJmpqaajwZAABA11Xz2Ovbt2+GDBmSmTNnJklmzpyZIUOGdPoSTgAAADZU197e3l7rIV555ZVceOGFWbFiRXr37p3m5ubstttutR4LAACgy9oqYg8AAIAtq+aXcQIAALDliT0AAIACiT0AAIACiT0AAIACiT1q4re//W3OOeecHHrooTn88MPzH//xH5s8/t13381RRx2VY445pkoT0pV1dr8effTRHHPMMRk9enSOOuqofPe7363ypHQV8+bNy9ixYzNq1KiMHTs28+fP3+CY1tbWXHzxxTnkkENy6KGH5q677qr+oHRZndmxadOm5aijjsqYMWNyzDHHZM6cOdUflC6pM/v1O7/61a+y1157pbm5uXoDUjFij5q46aab0rNnzzzyyCOZPn16Jk6cmFWrVn3o8VdffXX22muvKk5IV9bZ/erXr1/+5V/+JTNnzsztt9+e2267LU899VQNJmZrN3ny5IwbNy6zZ8/OuHHjMmnSpA2OaWlpyWuvvZaHH344d9xxR6699tq8/vrrNZiWrqgzOzZ06NDcfffdaWlpyZQpU3LuuedmzZo1NZiWrqYz+5W8/02ryZMn55BDDqnyhFSK2KMmHnzwwYwdOzZJsuuuu2aPPfbI448/vtFjn3rqqcyfPz9HH310NUekC+vsfu21114ZMGBAkqRXr17Zfffds2DBgqrOytZv6dKlmTt3bkaPHp0kGT16dObOnZtly5atd9ysWbNy3HHHpb6+Po2NjTnkkEPy0EMP1WJkupjO7tiBBx6Y7bbbLkkyePDgtLe356233qr2uHQxnd2vJLnxxhtz8MEHZ9ddd63ylFSK2KMmFi5cmB133LHj66ampvzmN7/Z4LjVq1dnypQpufjii6s5Hl1cZ/frg1555ZU8++yz2X///Ss9Hl3MokWLMmDAgDQ0NCRJGhoa0r9//yxatGiD4wYOHNjxdWf2DpLO79gH3XffffnUpz6VT37yk9Uaky6qs/v1y1/+Mj/+8Y/z5S9/uQZTUindaj0AZfrCF76QhQsXbvS+//qv/+r081x55ZUZN25cBgwYsMnry/l42VL79TtLlizJWWedlcmTJ3ec6QPYWv33f/93vv3tb3ufMVvMe++9l3/8x3/MFVdc0RGFlEHsURH33nvvJu8fOHBgFixYkMbGxiTvf9dp+PDhGxz3v//7v3n88cdz/fXX5913383bb7+dMWPGpKWlpSJz0zVsqf1K3r+85eSTT86pp56aI444YovPStfX1NSUxYsXp7W1NQ0NDWltbc2SJUvS1NS0wXELFy7M0KFDk2x4pg8+TGd3LEmeeeaZTJgwIddff3122223GkxLV9OZ/XrjjTfy2muv5fTTT0+SrFixIu3t7Vm5cmUuvfTSWo3OFuAyTmri8MMPzx133JEkmT9/fn72s5/lwAMP3OC4lpaWPPbYY3nsscdy1VVXZdCgQUKP36uz+7V8+fKcfPLJOfHEE3PcccdVe0y6iL59+2bIkCGZOXNmkmTmzJkZMmRIxzcTfufwww/PXXfdlba2tixbtiyPPvpoRo0aVYuR6WI6u2PPPfdczj333FxzzTX58z//81qMShfUmf0aOHBgnnzyyY7/5zrppJNy/PHHC70C1LW3t7fXegg+flavXp0LL7wwv/jFL1JfX58JEyZ0fPLTt7/97fTv3z9/8zd/s95jnnzyyTQ3N+f73/9+LUamC+nsfjU3N2fGjBn5kz/5k47HfulLX8qxxx5bq9HZSr3yyiu58MILs2LFivTu3TvNzc3Zbbfdctppp+Xss8/OnnvumdbW1lxyySV54oknkiSnnXZaxwcFwe/TmR079thjs2DBgvUuN7/yyiszePDgGk5OV9CZ/fqga6+9NqtXr87Xv/71Gk3MliL2AAAACuQyTgAAgAKJPQAAgAKJPQAAgAKJPQAAgAKJPQAAgAKJPQC6nNdffz2DBw/OunXrfu+xTz75ZA466KAqTFU9++yzT37961/XegwAtnLdaj0AAHyYESNG5M0330xDQ0PHbQ899FBNZlm7dm2uuuqqzJo1K++880623377jBw5Mt/4xjeqPsszzzzT8esLL7wwAwYMyLnnnlv1OQDYuok9ALZq06dPz2c/+9n1bnv99derPseNN96Y559/PnfddVf69++fBQsW5KmnnqrqDOvWrUu3bv7TDUDnuIwTgC7vnnvuyRFHHJF99tknI0eOzO233/6hx95666058sgj85vf/CZr165Nc3NzDj744Hz2s5/NpEmTsmbNmo0+7mc/+1kOOeSQDBgwIHV1ddlpp53y+c9/vuP+xYsXZ/z48dl///0zYsSI3HrrrR23Dx06NG+99VbHsXPnzs3w4cPz3nvvJUnuvvvuHHHEEfnMZz6TU045JQsWLOg4dvDgwZkxY0YOO+ywHHbYYR23vfrqq7njjjvS0tKSm266Kfvss0/OPPPMfOc738n48ePXm/2yyy7LZZdd9pH+TAHo+sQeAF1e3759c8MNN+Tpp5/OFVdckSuuuCI///nPNzjuuuuuy7333pt///d/zyc/+clMnTo18+bNy3333ZeHH344S5YsybRp0zb6GnvttVe+973vZcaMGXnhhRfS3t7ecV9bW1u+8pWvZPDgwXn88cdzyy235JZbbsmcOXMyYMCA7L333nn44Yc7jm9pacmoUaOyzTbb5NFHH80NN9yQ6667Lj/5yU+y33775fzzz1/vtR999NHceeedmTVr1nq3jx07NmPGjMkpp5ySZ555JtOnT8/nPve5zJkzJytWrEjy/tnABx54YL0wBeDjQewBsFX7u7/7uwwbNizDhg3LWWedtdFjDj744HzqU59KXV1d/uIv/iIHHHDAepdYtre354orrsgTTzyRW2+9NY2NjWlvb8+dd96Ziy66KH369EnPnj1zxhln5IEHHtjoa5xxxhk57bTT0tLSkmOPPTYHHnhg7r333iTvn/VbtmxZ/v7v/z7du3fPzjvvnOOPP74jzsaMGZOZM2d2zDJr1qyMGTMmSXL77bfn9NNPz+67755u3brlzDPPzC9+8Yv1zu6dfvrp6dOnT7bddtvf++fVv3//DBs2rOO9jXPmzMn222+fPfbY4/c+FoCyuPAfgK3atGnTNnjP3v/1ox/9KNOmTcv8+fPT1taWNWvWZNCgQR33v/POO7nzzjtz9dVXp1evXkmSZcuW5be//W2OOeaYjuPa29vT1ta20ddoaGjIiSeemBNPPDFr1qzJPffck4suuihDhw7NggULsmTJkgwbNqzj+NbW1o6vDzvssFx66aVZsmRJ5s+fn/r6+o77Fi5cmClTpqS5uXm9ORYvXpwdd9wxSdLU1PRR/sjyhS98IbfddluOP/74/OAHP8jRRx/9kR4PQBnEHgBd2tq1a3P22Wenubk5I0eOzDbbbJOzzjprvcsse/funW9961s555xzct1112W//fbL9ttvn2233TYPPPBABgwY8JFec9ttt82JJ56Ya665Ji+//HKampqy0047rXep5gf98R//cQ444IDMmjUrv/rVr3LkkUemrq4uyfshd+aZZ+Zzn/vch77e747t7H2HHHJIvvnNb+bFF1/Mf/7nf2bChAkf6fcHQBlcxglAl7Z27dqsXbs2jY2N6datW370ox/liSee2OC44cOHZ+rUqRk/fnyee+651NfX57jjjsuUKVOydOnSJO9/mMqcOXM2+jrf+9738uSTT2bNmjVZt25d7r333qxatSp/9md/lqFDh+YTn/hEbrzxxqxZsyatra158cUX89xzz3U8fsyYMbn//vsze/bsjks4k+SEE07IjTfemJdeeinJ+2chH3zwwU7//vv27bvBp5P26NEjo0aNyvnnn58999wzAwcO7PTzAVAOsQdAl9azZ89MnDgx55xzTj7zmc9k5syZGTFixEaPPeCAAzJlypSceeaZ+fnPf54JEyZkl112yfHHH5999903X/7ylzNv3ryNPna77bZLc3NzDjjggOy///6ZMWNGrr322uy8885paGjI9OnT88tf/jIjR47M/vvvn4kTJ2blypUdjx8xYkTmz5+fHXbYIX/6p3/acfuhhx6aU089Needd1723XffjB49Oo8//ninf/9//dd/nZdffnmD9zR+/vOfz4svvugSToCPsbr2D17nAgAUYeHChTniiCPyxBNPpGfPnrUeB4AacGYPAArT1taWm2++OUceeaTQA/gY8wEtAFCQ1atX54ADDsjAgQPzne98p9bjAFBDLuMEAAAokMs4AQAACiT2AAAACiT2AAAACiT2AAAACiT2AAAACiT2AAAACvT/AMy7RvM3ViBMAAAAAElFTkSuQmCC\n\" class=\"sc-bdVaJa jFcqvn\"/></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>Save results to Ceph or locally</h3>\n<ul>\n<li>Use the following helper function to save the data frame in a parquet format on the Ceph bucket if we are running in automation, and locally if not. </li>\n</ul></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[11]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">timestamp <span class=\"token\" style=\"color:#393A34\">=</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>datetime<span class=\"token\" style=\"color:#393A34\">.</span>now<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">if</span> AUTOMATION<span class=\"token\" style=\"color:#393A34\">:</span>\n    cc <span class=\"token\" style=\"color:#393A34\">=</span> CephCommunication<span class=\"token\" style=\"color:#393A34\">(</span>s3_endpoint_url<span class=\"token\" style=\"color:#393A34\">,</span> s3_access_key<span class=\"token\" style=\"color:#393A34\">,</span> s3_secret_key<span class=\"token\" style=\"color:#393A34\">,</span> s3_bucket<span class=\"token\" style=\"color:#393A34\">)</span>\n    cc<span class=\"token\" style=\"color:#393A34\">.</span>upload_to_ceph<span class=\"token\" style=\"color:#393A34\">(</span>\n        df<span class=\"token\" style=\"color:#393A34\">,</span>\n        s3_path<span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>METRIC_NAME<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>METRIC_NAME<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>year<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>month<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>day<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">.parquet&quot;</span></span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    save_to_disk<span class=\"token\" style=\"color:#393A34\">(</span>\n        df<span class=\"token\" style=\"color:#393A34\">,</span>\n        OUTPUT_DATA_PATH<span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>METRIC_NAME<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>year<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>month<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>day<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">.parquet&quot;</span></span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[12]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\">## Sanity check to see if the dataset is the same</span>\n<span class=\"token\" style=\"color:#0000ff\">if</span> AUTOMATION<span class=\"token\" style=\"color:#393A34\">:</span>\n    sanity_check <span class=\"token\" style=\"color:#393A34\">=</span> cc<span class=\"token\" style=\"color:#393A34\">.</span>read_from_ceph<span class=\"token\" style=\"color:#393A34\">(</span>\n        s3_path<span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>METRIC_NAME<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>METRIC_NAME<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>year<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>month<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>day<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">.parquet&quot;</span></span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    sanity_check <span class=\"token\" style=\"color:#393A34\">=</span> read_from_disk<span class=\"token\" style=\"color:#393A34\">(</span>\n        OUTPUT_DATA_PATH<span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>METRIC_NAME<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>year<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>month<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>day<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">.parquet&quot;</span></span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n\nsanity_check</code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>timestamp</th>\n      <th>tab</th>\n      <th>grid</th>\n      <th>test</th>\n      <th>test_duration</th>\n      <th>flake</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2021-03-15 23:40:20</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>80.283333</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2021-03-15 00:01:06</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>92.050000</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2021-03-13 20:51:32</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>80.983333</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2021-03-13 07:51:20</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>117.716667</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2021-03-13 06:43:20</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>108.633333</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>195</th>\n      <td>2021-03-12 16:31:36</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>openshift-tests.[sig-api-machinery] CustomReso...</td>\n      <td>NaN</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>196</th>\n      <td>2021-03-11 17:51:37</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>openshift-tests.[sig-api-machinery] CustomReso...</td>\n      <td>NaN</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>197</th>\n      <td>2021-03-11 11:53:33</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>openshift-tests.[sig-api-machinery] CustomReso...</td>\n      <td>NaN</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>198</th>\n      <td>2021-03-11 02:04:17</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>openshift-tests.[sig-api-machinery] CustomReso...</td>\n      <td>NaN</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>199</th>\n      <td>2021-03-11 00:12:10</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>openshift-tests.[sig-api-machinery] CustomReso...</td>\n      <td>NaN</td>\n      <td>False</td>\n    </tr>\n  </tbody>\n</table>\n<p>200 rows  6 columns</p>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h3>Conclusion</h3>\n<ul>\n<li>Report the status of the calculation that you aimed to complete in this notebook.</li>\n<li>Highlight any difficulties in the calculation of the metric.</li>\n<li>Optional: Add any side notes, future efforts</li>\n</ul>\n<h3><em>Example Conclusion</em></h3>\n<p><em>This notebook computed number of flakes and the flake severity metric. The dataframe saved on ceph can be used to generate aggregated views and visualizations.</em></p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"></code></pre></div></div></div></div>","fields":{"srcLink":"https://github.com/aicoe-aiops/ocp-ci-analysis/blob/master/notebooks/data-sources/TestGrid/metrics/metric_template.ipynb"}}},"pageContext":{"id":"6299985e-eac3-5f66-becf-f3af416b723a >>> JupyterNotebook"}},"staticQueryHashes":["117426894","3000541721","3606484676","533861647"]}