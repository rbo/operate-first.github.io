{"componentChunkName":"component---src-templates-markdown-js","path":"/users/apps/docs/argocd/update_argocd.md","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"markdownRemark":{"id":"7ebec83e-1bfc-522e-8ce5-db0f4debd84c","html":"<h1 id=\"steps-for-upgrading-argocd\" style=\"position:relative;\"><a href=\"#steps-for-upgrading-argocd\" aria-label=\"steps for upgrading argocd permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Steps for Upgrading ArgoCD</h1>\n<p>Here’s a list of relevant release pages you might find useful:</p>\n<ul class=\"pf-c-list\">\n<li>ArgoCD releases: <a href=\"https://github.com/argoproj/argo-cd/releases\">link</a></li>\n<li>KSOPS releases: <a href=\"https://github.com/viaduct-ai/kustomize-sops/releases\">link</a></li>\n<li>Kustomize releases: <a href=\"https://github.com/kubernetes-sigs/kustomize/releases\">link</a></li>\n<li>SOPS releases: <a href=\"https://github.com/mozilla/sops/releases\">link</a></li>\n<li>Helm-Secrets releases: <a href=\"https://github.com/zendesk/helm-secrets/releases\">link</a></li>\n</ul>\n<p>First checkout the upgrade docs <a href=\"https://argoproj.github.io/argo-cd/operator-manual/upgrading/overview/\">here</a> to see if there have been any major/breaking changes, or additional steps that will be required when updating between versions.</p>\n<h1 id=\"changes-to-operate-firstcontinuous-deployment\" style=\"position:relative;\"><a href=\"#changes-to-operate-firstcontinuous-deployment\" aria-label=\"changes to operate firstcontinuous deployment permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Changes to operate-first/continuous-deployment</h1>\n<h3 id=\"determine-version-number\" style=\"position:relative;\"><a href=\"#determine-version-number\" aria-label=\"determine version number permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Determine version Number</h3>\n<p>The version number will be referred throughout this doc, it takes the form of <code class=\"language-text\">X.X.X-Y</code>. Where <code class=\"language-text\">X.X.X</code> refers to the ArgoCD version number, and the <code class=\"language-text\">-Y</code> suffix, refers to our custom version that iterates on the <code class=\"language-text\">X.X.X</code> ArgoCD version. The <code class=\"language-text\">-Y</code> value indicates the version number for our custom tooling. If we are simply updating the custom tooling, then we only bump <code class=\"language-text\">-Y</code> value. For example if we are updating our custom tooling for <code class=\"language-text\">1.7.8-1</code> but keeping ArgoCD at <code class=\"language-text\">1.7.8</code> then we would bump the version to <code class=\"language-text\">1.7.8-2</code>.</p>\n<p>We’ll use <code class=\"language-text\">X.X.X-Y</code> as the placeholder for this value throughout the doc.</p>\n<h3 id=\"update-dockerfile\" style=\"position:relative;\"><a href=\"#update-dockerfile\" aria-label=\"update dockerfile permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Update Dockerfile</h3>\n<p>Fork/Clone the <code class=\"language-text\">operate-first/continuous-deployment</code> repo.</p>\n<p>Open the <code class=\"language-text\">Dockerfile</code> and bump the <code class=\"language-text\">ARGO_CD_VERSION</code> to the new ArgoCD Version. If upgrading <code class=\"language-text\">KSOPS</code> then also bump <code class=\"language-text\">KSOPS_VERSION</code> to the newer version. Similarly change <code class=\"language-text\">SOPS_VERSION</code> and <code class=\"language-text\">HELM_SECRETS_VERSION</code> if needed.</p>\n<p>Create a pull request.</p>\n<h3 id=\"create-tag-release\" style=\"position:relative;\"><a href=\"#create-tag-release\" aria-label=\"create tag release permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create tag release</h3>\n<p>Once it’s merged create a new tag in the <code class=\"language-text\">operate-first/continuous-deployment</code> in the form of <code class=\"language-text\">vX.X.X-Y</code>, where <code class=\"language-text\">X.X.X-Y</code> should resolve to the version number as described <a href=\"#determine-version-number\">here</a>. This tag will be used by downstream, and should never be changed once it’s created.</p>\n<p>Once the tag is created, a bot will create the build and publish it to <a href=\"https://quay.io/operate-first/argocd\">https://quay.io/operate-first/argocd</a>.</p>\n<h1 id=\"changes-to-operate-firstapps\" style=\"position:relative;\"><a href=\"#changes-to-operate-firstapps\" aria-label=\"changes to operate firstapps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Changes to operate-first/apps</h1>\n<p>Fork/Clone the <code class=\"language-text\">operate-first/apps</code> repo.</p>\n<h2 id=\"updating-redis-image\" style=\"position:relative;\"><a href=\"#updating-redis-image\" aria-label=\"updating redis image permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Updating Redis image</h2>\n<p>Upstream uses <code class=\"language-text\">redis</code> on docker for their image, we prefer to use <code class=\"language-text\">quay</code> so we don’t encounter rate-limit issues. Unfortunately this means we need to also push a new <code class=\"language-text\">redis</code> image to our <code class=\"language-text\">quay</code> org whenever newer <code class=\"language-text\">redis</code> is introduced in <code class=\"language-text\">ArgoCD</code>.</p>\n<p>Check <a href=\"https://github.com/argoproj/argo-cd/blob/master/manifests/install.yaml\">here</a>, under the tag appropriate ArgoCD version tag. Search for the <code class=\"language-text\">redis</code> deployment and see if the tag version for <code class=\"language-text\">redis</code> under <code class=\"language-text\">containers/0/image</code> has been updated. If it has, then push this new image onto <code class=\"language-text\">quay.io/operate-first/redis</code>. For example, if adding <code class=\"language-text\">redis:5.0.10-alpine</code> we would do the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ podman pull redis:5.0.10-alpine\n$ podman push redis:5.0.10-alpine quay.io/operate-first/redis:5.0.10-alpine</code></pre></div>\n<p>Next, under the <code class=\"language-text\">images</code> section <a href=\"https://github.com/operate-first/apps/blob/master/argocd/base/kustomization.yaml\">here</a> update the <code class=\"language-text\">newTag</code> field for the <code class=\"language-text\">redis</code> image accordingly. Folowing from our example above, we would have the following new image in our <code class=\"language-text\">Kustomization</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis\n    <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> quay.io/operate<span class=\"token punctuation\">-</span>first/redis\n    <span class=\"token key atrule\">newTag</span><span class=\"token punctuation\">:</span> 5.0.10<span class=\"token punctuation\">-</span>alpine</code></pre></div>\n<h2 id=\"update-argocd-manifests\" style=\"position:relative;\"><a href=\"#update-argocd-manifests\" aria-label=\"update argocd manifests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Update ArgoCD Manifests</h2>\n<p>If updating ArgoCD’s version, perform the following:</p>\n<ul class=\"pf-c-list\">\n<li>Bump image ref to the new custom image in the root <code class=\"language-text\">Kustomization</code> <a href=\"https://github.com/operate-first/apps/blob/master/argocd/base/kustomization.yaml#L4\">here</a>.</li>\n<li>\n<p>Ensure the <code class=\"language-text\">CustomResourceDefinition</code>, <code class=\"language-text\">ClusterRoles</code>, <code class=\"language-text\">ClusterRoleBindings</code> in the <code class=\"language-text\">cluster-scope</code> app are synced with upstream for the new <code class=\"language-text\">ArgoCD</code> version.</p>\n<p>To do this, run the following from repo root:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># TAG is a tag from https://github.com/argoproj/argo-cd/tags</span>\n$ ./scripts/argocd/update_cluster_resources.sh <span class=\"token variable\">${TAG}</span></code></pre></div>\n</li>\n<li>Do a search for other references to <code class=\"language-text\">github.com/argoproj/argo-cd</code> update accordingly where applicable.</li>\n</ul>\n<h2 id=\"update-container-images\" style=\"position:relative;\"><a href=\"#update-container-images\" aria-label=\"update container images permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Update Container Images</h2>\n<p>Under the <code class=\"language-text\">images</code> section <a href=\"https://github.com/operate-first/apps/blob/master/argocd/base/kustomization.yaml#L16\">here</a>, update the <code class=\"language-text\">operate-first/argocd</code> tag to <code class=\"language-text\">vX.X.X-Y</code>. For example, if updating to <code class=\"language-text\">v1.8.1-2</code> we would have the following new image in our <code class=\"language-text\">Kustomization</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> argoproj/argocd\n    <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> quay.io/operate<span class=\"token punctuation\">-</span>first/argocd\n    <span class=\"token key atrule\">newTag</span><span class=\"token punctuation\">:</span> v1.8.1<span class=\"token punctuation\">-</span><span class=\"token number\">2</span></code></pre></div>\n<p>Run a manual <code class=\"language-text\">kustomize build</code> for the <code class=\"language-text\">argocd</code> overlay, and ensure that the images are updated in the deployment specs as intended.</p>\n<h1 id=\"changes-to-operate-firsttoolbox\" style=\"position:relative;\"><a href=\"#changes-to-operate-firsttoolbox\" aria-label=\"changes to operate firsttoolbox permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Changes to operate-first/toolbox</h1>\n<p>If updating any of the custom tooling (e.g. sops, ksops, helm, helm-secrets, etc.), these changes should also be brought to <code class=\"language-text\">operate-first/toolbox</code>, simply update the Dockerfile <a href=\"https://github.com/operate-first/toolbox/blob/master/Dockerfile\">here</a>, you will likely only need to update the version variables.</p>\n<p>Update the version in the readme (to the version we’ll be tagging), and cut a new tag so that a new tag-release build is initiated.</p>\n<h1 id=\"update-docs\" style=\"position:relative;\"><a href=\"#update-docs\" aria-label=\"update docs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Update Docs</h1>\n<p>We make an attempt to list the current versions of our tooling <a href=\"https://github.com/operate-first/continuous-deployment/blob/master/README.md\">here</a>. So update these accordingly.</p>","fields":{"srcLink":"https://github.com/operate-first/apps/blob/master/docs/argocd/update_argocd.md"},"frontmatter":{"title":"","description":null,"extraClasses":null}}},"pageContext":{"id":"7ebec83e-1bfc-522e-8ce5-db0f4debd84c"}},"staticQueryHashes":["117426894","3000541721","3606484676","533861647"]}