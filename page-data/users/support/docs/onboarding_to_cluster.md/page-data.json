{"componentChunkName":"component---src-templates-markdown-js","path":"/users/support/docs/onboarding_to_cluster.md","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"markdownRemark":{"id":"ca00a190-a6a7-5ac2-a1eb-eb24d6d2fa71","html":"<h1 id=\"onboarding-to-a-cluster\" style=\"position:relative;\"><a href=\"#onboarding-to-a-cluster\" aria-label=\"onboarding to a cluster permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Onboarding to a cluster</h1>\n<p>This document serves as a guide for adding cluster scoped resources of <code class=\"language-text\">Namespace</code> and <code class=\"language-text\">Group</code> kinds. Following steps in this guide should result in a PR against the <a href=\"https://github.com/operate-first/apps\">operate-first/apps</a> repository.</p>\n<p>Currently we support 2 ways to request/perform onboarding to any supported clusters:</p>\n<ol class=\"pf-c-list\">\n<li>Make an Onboarding issue request. Use the <strong>Onboarding to Cluster</strong> issue template in <a href=\"https://github.com/operate-first/support\">operate-first/support</a> repository.</li>\n<li>Opening a PR with the desired changes. The rest of this doc focuses on this second option. We’d gladly welcome your contributions.</li>\n</ol>\n<blockquote>\n<p>NOTE: Choosing option 2 requires a PR to be made for onboarding after completing the steps outlined below. The actual\nchanges will NOT take affect until after this PR is merged.</p>\n</blockquote>\n<h2 id=\"prerequisites\" style=\"position:relative;\"><a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prerequisites</h2>\n<p>You will need pre-requisite tools to follow along with this doc, please do one of the following:</p>\n<ul class=\"pf-c-list\">\n<li>Install our <a href=\"https://github.com/operate-first/toolbox\">toolbox</a> to have the developer setup ready automatically for you.</li>\n<li>Install the tools manually. You’ll need <a href=\"https://kustomize.io/\">kustomize</a>, <a href=\"https://github.com/mozilla/sops\">sops</a> and <a href=\"https://github.com/viaduct-ai/kustomize-sops\">ksops</a>.</li>\n</ul>\n<p>You will also need the <code class=\"language-text\">opfcli</code> install the latest version from <a href=\"https://github.com/operate-first/opfcli/releases\">here</a>.</p>\n<p>Please fork/clone the <a href=\"https://github.com/operate-first/apps\">operate-first/apps</a> repository. <strong>During this whole setup, we’ll be working within this repository.</strong></p>\n<p>For successful completion of this guide you need to understand what the aim is. Please have prepared following data:</p>\n<ul class=\"pf-c-list\">\n<li>Name of the onboarded team.</li>\n<li>Desired namespace name. Please use your team name as a prefix. This will make it easier for you to <a href=\"./onboarding_to_argocd.md\">onboard to ArgoCD</a> later on.</li>\n<li>List of users you’d like to add to your team.</li>\n<li>An optional team GPG key, in case you would like to modify the encrypted list of users of your team later on.</li>\n</ul>\n<h2 id=\"recipe\" style=\"position:relative;\"><a href=\"#recipe\" aria-label=\"recipe permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recipe</h2>\n<p>If you want to know more about the overall design please consult the ADR documentation at <a href=\"https://github.com/operate-first/blueprint\">operate-first/support</a>.</p>\n<p>In general we store all the cluster-scoped resources in a <code class=\"language-text\">cluster-scope</code> kustomize application within this repository.</p>\n<h2 id=\"adding-namespaces\" style=\"position:relative;\"><a href=\"#adding-namespaces\" aria-label=\"adding namespaces permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adding namespaces</h2>\n<p>For easier <a href=\"./onboarding_to_argocd.md\">onboard to ArgoCD</a> later on, we prefer to follow a name pattern for all our namespaces. Please use your team name as a prefix to the namespace name like so: <code class=\"language-text\">$OWNER_TEAM-example-project</code>.</p>\n<h3 id=\"base-resources\" style=\"position:relative;\"><a href=\"#base-resources\" aria-label=\"base resources permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Base resources</h3>\n<p>Please run:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">opfcli create-project $NAMESPACE_NAME $OWNER_TEAM -d $OPTIONAL_PROJECT_DESCRIPTION</code></pre></div>\n<p>This command will create:</p>\n<ul class=\"pf-c-list\">\n<li>A namespace in <code class=\"language-text\">cluster-scope/base/core/namespaces/$NAMESPACE_NAME</code></li>\n<li>A blank user group for the <code class=\"language-text\">$OWNER_TEAM</code> if it does not exist yet in the <code class=\"language-text\">cluster-scope/base/user.openshift.io/groups/$OWNER_TEAM</code></li>\n<li>An RBAC component for the project admin role <code class=\"language-text\">RoleBinding</code> in <code class=\"language-text\">cluster-scope/components/namespace-admin-rolebinding/$OWNER_TEAM</code> and maps it to the newly added namespace.</li>\n</ul>\n<h3 id=\"enabling-namespace-deployment-to-zero-cluster\" style=\"position:relative;\"><a href=\"#enabling-namespace-deployment-to-zero-cluster\" aria-label=\"enabling namespace deployment to zero cluster permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Enabling namespace deployment to Zero cluster</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">cd cluster-scope/overlays/prod/$ENV/$TARGET_CLUSTER</code></pre></div>\n<p>Open the <code class=\"language-text\">kustomization.yaml</code> file in this folder and add <code class=\"language-text\">../../base/core/namespaces/$NAMESPACE</code> to the <code class=\"language-text\">resources</code> field.\nWe aim to keep this field alphabetically sorted for better human readability:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization\n\n<span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">...</span>\n<span class=\"token punctuation\">-</span> ../../base/core/namespaces/$NAMESPACE\n<span class=\"token punctuation\">...</span></code></pre></div>\n<h3 id=\"authenticate-via-openshift\" style=\"position:relative;\"><a href=\"#authenticate-via-openshift\" aria-label=\"authenticate via openshift permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authenticate via OpenShift</h3>\n<p>Users are automatically created upon login to the appropriate cluster. This is done by logging in via SSO (any gmail account will work).</p>\n<p>For the <code class=\"language-text\">MOC/Zero</code> you can access the login from <a href=\"https://console-openshift-console.apps.zero.massopen.cloud/\">this link</a>.</p>\n<p>This will lead the user to an authentication provider selection screen:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/operate-first.github.io/static/41d5444de5d7811511f70e925827df78/2c95d/openshift-login.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.756756756756754%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABH0lEQVQY022PTWvCQBiEN4kREj8IuBqh4E1KJYdWKdKESqM/RlNyrwcTyLUHLaSH/sLSUs3HJprNkma7FSwtdHgY5jK88wJd1z3PcxzHdd3VSc5q9cC0XN6ZJgCAq1S+neN4QfgNsG2bUprnmJC8LEt6UlEUzDe+zwFw3mye9XqKooC/fWBZFinK949wF6I4zXYIx3ucHvI4ObDy43rNA3CrqjeTiaZpsN1Wu11GR1UFNseazykm+wDhKEkD9PYaxNs4C1GyjWhePD9t2GBeFP+ffb9YUFLgCLFbBKVZlJwCop/0xfclSepAWKvXxWqVFTie/wH0+/3pbDY1TcMwLofD4Wh0dYTl6/H4YjBotVqdoyCE7O1GoyHXapIsM74A0AaPe4pI7aQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Auth provider selection screen in OpenShift\"\n        title=\"Auth provider selection screen in OpenShift\"\n        src=\"/operate-first.github.io/static/41d5444de5d7811511f70e925827df78/fcda8/openshift-login.png\"\n        srcset=\"/operate-first.github.io/static/41d5444de5d7811511f70e925827df78/12f09/openshift-login.png 148w,\n/operate-first.github.io/static/41d5444de5d7811511f70e925827df78/e4a3f/openshift-login.png 295w,\n/operate-first.github.io/static/41d5444de5d7811511f70e925827df78/fcda8/openshift-login.png 590w,\n/operate-first.github.io/static/41d5444de5d7811511f70e925827df78/efc66/openshift-login.png 885w,\n/operate-first.github.io/static/41d5444de5d7811511f70e925827df78/2c95d/openshift-login.png 1099w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Please select <code class=\"language-text\">moc-sso</code> provider. Then choose the final account provider that fits you the most:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/operate-first.github.io/static/ed3bba46cd55445b2162eb2f8b11683c/9d5da/moc-login.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.21621621621621%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB2ElEQVQoz42Qy27aUBCG/VAIqSEyILCpTczlBBuDASdWnIaKVKVIAaGwSTZ9i27Y9A24vAewARWxRGlsxwYjLu7knASo1EU/WaM5mv+fiylVVUulEkRN0yAWCQVFubzKamUpcy6q1ylRTiWTgiDwPP/xCKqEIS1kWc4BEItqpnyXrj6iyn1au00V9URCiGM4jiPOWCx2MMM8mZCVcpefxOuv6e8/0cMPdHED5rP4AeJnGOZgLhQKe3P2QkdXX9JFHZUb6OZOkBSe43gMOGFmOBwOhULUfud8Pp/FSJKE0HkiIws8lxTiZ8kUy0TBwLIsg4lEIjRNB4NBShRFhElg4K/ASqBjo5Eow8AXpOmTkw+BQOD0Hch9Pp/f76cqlUqr1Wo2m41Go16v12q1b0dUq1UQlN/5jIFE13VFUah+v+953maz2e122+12d8RqtXJdd//0MEQGyXA4pHq9HjF7RxDpAgNSqK7X6xVmjYHqYDB4NYPUNE3btiFalmUahuM4pAWZDyyWC8M0oL5cwjbum7nb7cKyT0+/n58Ny3pxnMWLbcNAUJCZtu24GOgIbkig+mbudDqQkTP+E3LUaDSi2u32fD6fTqez2Wz6L379zWQyGY/HIIZ7/wA5bOFwi4onAgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"MOC auth provider selection screen\"\n        title=\"MOC auth provider selection screen\"\n        src=\"/operate-first.github.io/static/ed3bba46cd55445b2162eb2f8b11683c/fcda8/moc-login.png\"\n        srcset=\"/operate-first.github.io/static/ed3bba46cd55445b2162eb2f8b11683c/12f09/moc-login.png 148w,\n/operate-first.github.io/static/ed3bba46cd55445b2162eb2f8b11683c/e4a3f/moc-login.png 295w,\n/operate-first.github.io/static/ed3bba46cd55445b2162eb2f8b11683c/fcda8/moc-login.png 590w,\n/operate-first.github.io/static/ed3bba46cd55445b2162eb2f8b11683c/9d5da/moc-login.png 871w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>With the user now created, we will need to provide them with appropriate rbac access to this namespace.</p>\n<h2 id=\"giving-users-rbac-permissions\" style=\"position:relative;\"><a href=\"#giving-users-rbac-permissions\" aria-label=\"giving users rbac permissions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Giving Users Rbac Permissions</h2>\n<p>The following steps enable users to access designated cluster/namespaces. This consists of adding users to the appropriate OpenShift groups.</p>\n<p>Navigate to <code class=\"language-text\">cluster-scope/overlays/prod/$ENV/$TARGET_CLUSTER</code>.</p>\n<blockquote>\n<p>Note for moc/zero or moc/infra navigate to <code class=\"language-text\">cluster-scope/overlays/prod/moc/common</code> instead</p>\n</blockquote>\n<p>Create the following resource describing the users in your group:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># groups/GROUP_NAME.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> user.openshift.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Group\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> GROUP_NAME\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">kustomize.config.k8s.io/behavior</span><span class=\"token punctuation\">:</span> replace\n<span class=\"token key atrule\">users</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> USER_1\n  <span class=\"token punctuation\">-</span> USER_2</code></pre></div>\n<blockquote>\n<p>Note that the USER_n value is the email used to login via SSO in the preceeding steps.</p>\n</blockquote>\n<p>Encrypt the file with sops. You can find the key to import from <a href=\"https://github.com/operate-first/apps/tree/master/cluster-scope/overlays/prod/moc#secret-management\">here</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ sops --encrypt --encrypted-regex=&quot;^users$&quot; --pgp=&quot;0508677DD04952D06A943D5B4DC4116D360E3276&quot; groups/GROUP_NAME.yaml &gt; groups/GROUP_NAME.enc.yaml\n$ grep &quot;fp: &quot; groups/GROUP_NAME.enc.yaml\n        fp: 0508677DD04952D06A943D5B4DC4116D360E3276</code></pre></div>\n<p>If you or your team needs the ability to decrypt this file, you may include additional PGP key fingerprints in the sops command:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ sops --encrypt --encrypted-regex=&quot;^users$&quot; --pgp=&quot;0508677DD04952D06A943D5B4DC4116D360E3276, YOUR_GPG_KEY_FINGERPRINT&quot; groups/GROUP_NAME.yaml &gt; groups/GROUP_NAME.enc.yaml\n$ grep &quot;fp: &quot; groups/GROUP_NAME.enc.yaml\n        fp: 0508677DD04952D06A943D5B4DC4116D360E3276\n        fp: YOUR_GPG_KEY_FINGERPRINT</code></pre></div>\n<p>Explanation to the <code class=\"language-text\">sops</code> command:</p>\n<ul class=\"pf-c-list\">\n<li><code class=\"language-text\">encrypt</code> flag encrypts a resource</li>\n<li><code class=\"language-text\">encrypted-regex</code> value maps to the XPath-like regex to specifies which parts of the file should be encrypted. The rest of the file is left as a plaintext for easier management. In this case we want to encrypt only the <code class=\"language-text\">users</code> property in the file. See the docs <a href=\"https://github.com/mozilla/sops#encrypting-only-parts-of-a-file\">here</a>.</li>\n<li><code class=\"language-text\">pgp</code> list all the GPG keys which will be used to encrypt this file.</li>\n</ul>\n<p>Don’t forget to remove the plaintext variant of the resource before staging for a commit:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">rm groups/GROUP_NAME.yaml</code></pre></div>\n<p>And list the sops encrypted file in the secret generator file:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># secret-generator.yaml</span>\n<span class=\"token key atrule\">files</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token punctuation\">-</span> groups/GROUP_NAME.enc.yaml</code></pre></div>\n<p>Use sops to edit the encrypted group resource patch as:</p>\n<blockquote>\n<p>Note you can only do this if you included your pgp key in the step above, otherwise ensure all users are added before first encrypting the file.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">sops groups/GROUP_NAME.enc.yaml</code></pre></div>\n<p>Then simply append the list of users with the new users that need to be added.</p>\n<h2 id=\"finalize\" style=\"position:relative;\"><a href=\"#finalize\" aria-label=\"finalize permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Finalize</h2>\n<p>Please stage your changes and send them as a PR against the <a href=\"https://github.com/operate-first/apps\">operate-first/apps</a> repository. Make sure:</p>\n<ul class=\"pf-c-list\">\n<li>Change set includes only your modifications within the <code class=\"language-text\">cluster-scope</code> application.</li>\n<li>Change set may include your optional changes to the <code class=\"language-text\">.sops.yaml</code> file.</li>\n<li>Your commit <strong>doesn’t include any sensitive data such as an unencrypted resource</strong>, such resources should be included only as encrypted.</li>\n</ul>","fields":{"srcLink":"https://github.com/operate-first/support/blob/master/docs/onboarding_to_cluster.md"},"frontmatter":{"title":"","description":null,"extraClasses":null}}},"pageContext":{"id":"ca00a190-a6a7-5ac2-a1eb-eb24d6d2fa71"}},"staticQueryHashes":["117426894","3000541721","3606484676","533861647"]}